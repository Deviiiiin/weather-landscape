<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>你好~</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; }
        #bg-img {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            z-index: -1;
        }
    </style>
</head>
<body>
    <!-- 初始风景兜底图 -->
    <img id="bg-img" alt="风景图" src="https://images.pexels.com/photos/1640774/pexels-photo-1640774.jpeg?auto=compress&cs=tinysrgb&w=1600">

    <script>
        // 核心配置
        const PEXELS_API_KEY = "lqOaQCzRbfr0BDueszU1hf1ZSQCmKdx1ifiVvDWUDIC1Xn8MZMmyh5rl";
        const STORAGE_KEY = "daily-scenery-photo"; // 存储每日图片信息

        // 1. 获取当前日期（格式：20251224），判断是否需要刷新
        function getToday() {
            const d = new Date();
            return `${d.getFullYear()}${String(d.getMonth()+1).padStart(2,0)}${String(d.getDate()).padStart(2,0)}`;
        }

        // 2. 从本地存储获取当日图片
        function getDailyPhoto() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (!stored) return null;
            return JSON.parse(stored);
        }

        // 3. 保存当日图片到本地存储
        function saveDailyPhoto(photoData) {
            const data = {
                date: getToday(),
                imgUrl: photoData.url,
                photoId: photoData.id
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // 4. 从Pexels获取随机风景图（只搜风景，简单直接）
        async function fetchSceneryPhoto() {
            try {
                // 只搜“风景”关键词，简单粗暴
                const res = await fetch(`https://api.pexels.com/v1/search?query=landscape,natural scenery&per_page=30&page=${Math.floor(Math.random()*5)+1}`, {
                    headers: { Authorization: PEXELS_API_KEY }
                });
                if (!res.ok) throw new Error("API请求失败");
                
                const data = await res.json();
                const randomPhoto = data.photos[Math.floor(Math.random()*data.photos.length)];
                return {
                    url: randomPhoto.src.large, // 稳定的large尺寸
                    id: randomPhoto.id.toString()
                };
            } catch (error) {
                console.log("获取图片失败，使用兜底图：", error);
                // 兜底风景图（永远是风景，不会失效）
                return {
                    url: "https://images.pexels.com/photos/1640774/pexels-photo-1640774.jpeg?auto=compress&cs=tinysrgb&w=1600",
                    id: "fallback-1640774"
                };
            }
        }

        // 5. 主逻辑：每天0点自动刷新
        async function initBackground() {
            const bgImg = document.getElementById('bg-img');
            const today = getToday();
            const dailyPhoto = getDailyPhoto();

            // 如果是新的一天（凌晨0点后），获取新图；否则用缓存图
            if (!dailyPhoto || dailyPhoto.date !== today) {
                const newPhoto = await fetchSceneryPhoto();
                bgImg.src = newPhoto.url;
                saveDailyPhoto(newPhoto);
            } else {
                bgImg.src = dailyPhoto.imgUrl;
            }
        }

        // 初始化加载
        window.addEventListener("load", initBackground);

        // 可选：监听凌晨0点，主动刷新（防止页面一直开着不刷新）
        setInterval(() => {
            const now = new Date();
            // 每小时检查一次，只要到0点且分钟<5，就刷新
            if (now.getHours() === 0 && now.getMinutes() < 5) {
                initBackground();
            }
        }, 3600000); // 1小时检查一次
    </script>
</body>
</html>
